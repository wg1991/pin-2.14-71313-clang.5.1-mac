<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>XED: XED command interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">XED
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__CMDLINE.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">XED command interface</div>  </div>
</div><!--header-->
<div class="contents">
<p>The command line tool called xed or xed.exe is built when you build the examples (<a class="el" href="group__EXAMPLES.html">Examples of using XED</a>) that come with XED. The xed-ex3 is just encode portion of the xed command line tool.</p>
<p>This tool is useful for encoding and decoding or even decoding-then-re-encoding a single instruction or all the instructions in the text segment of an ELF binary (32 or 64b). For decoding, just jump to the examples.</p>
<p>This section also explains a little language for writing the instructions for encode requests (-e option). I am constantly using this tool and updating it. The xed-ex3 (xed-ex3.exe) example is just the encoder portion of the xed command line tool.</p>
<p>The SUPPRESSED operands emitted by the decoder are not used when encoding. They are ignored. They are not required to select an encoding.</p>
<p>The syntax for encodable strings is as follows: </p><div class="fragment"><div class="line">Opcode[/width]   [operand [operand]]</div>
</div><!-- fragment --><p>The width is a 8, 16, 32 or 64, indicating the effective operand width if it differs from the default. 8b operations generally require this. Or since most operations that default to 32b widths in 64b mode, it is required for 64b operation widths in 64b mode.</p>
<p>The operand specifier is one of the following.</p>
<ul>
<li>A register name such as EAX or R8B, etc. Case does not matter.</li>
<li>An immediate specifier such as IMM:12ff</li>
<li>A branch displacement specifier such as BRDISP:0000001f</li>
<li>A memory specifier that indicates the base register, index register, scale value, and displacement value. If one of the fields is not required, a - is necessary. The displacement is omittable. For example: MEM4:ESI,EAX,8,ff or MEM4:EBX. The first one specifies that the memory address 4 bytes and should be ESI + EAX * 8 + 0xff. The second one specifies that EBX should be used to access 4 bytes of memory; note the displacement is omitted. A segment override can be specified as follows: MEM4:GS:EAX by using a segment-name followed by a ":" before the base register. If there is no base register, you can use a "-", for example: MEM4:GS:-,-,11223344. One also needs to specify a memory operation width. This can be accomplished by indicating a number of bytes just after the MEM specifier. For example: MEM2:EAX indicates a 2 byte memory operation.</li>
<li>If the Haswell gather instructions are included in the build, then you can also specify a VSIB memop as follows: VSIB4:RAX,YMM2,2,ff. This would be a memory operand for a gather with RAX as the base, YMM2 as the gather index register. The scale is 2 and the displacement is 0xff. The element size is 4 (dwords, 4 bytes). Use 8 for qwords (8 bytes).</li>
<li>An address generation specifer that has the same syntax as the above MEM: specifier, but is only used for LEA instructions. Example: AGEN:EAX,EBX,2,-</li>
</ul>
<p>Here is the help message:</p>
<div class="fragment"><div class="line">% obj/xed -h</div>
<div class="line">Usage: obj/xed [options]</div>
<div class="line">One of the following is required:</div>
<div class="line">  -i input_file             (decode file)</div>
<div class="line">  -ide input_file           (decode/encode file)</div>
<div class="line">  -d hex-string             (decode one instruction)</div>
<div class="line">  -e instruction            (encode, must be last)</div>
<div class="line">  -de hex-string            (decode-then-encode)</div>
<div class="line"> </div>
<div class="line">Optional arguments:</div>
<div class="line">  -v verbosity  (0=quiet, 1=errors, 2=useful-info, 3=trace, 5=very verbose)</div>
<div class="line">  -n number-of-instructions-to-decode (default 10,000, accepts K/M/G qualifiers)</div>
<div class="line">  -I            (Intel SYSV syntax for disassembly)</div>
<div class="line">  -A            (ATT SYSV syntax for disassembly)</div>
<div class="line">  -16           (for LEGACY_16 mode)</div>
<div class="line">  -32           (for LEGACY_32 mode, default)</div>
<div class="line">  -64           (for LONG_64 mode w/64b addressing)</div>
<div class="line">  -s32          (32b stack addressing, default, not in LONG_64 mode)</div>
<div class="line">  -s16          (16b stack addressing, not in LONG_64 mode)</div>
</div><!-- fragment --><p>Here are a couple of examples:</p>
<div class="fragment"><div class="line">% xed -d 0000</div>
<div class="line">ADD INT_ALU BASE  Opcode: 00  MODRM: 00 Bytes: 2</div>
<div class="line">        Eb/EXPLICIT/RW Gb/EXPLICIT/R </div>
<div class="line">        ADD EffWidth: 8b</div>
<div class="line">        MachineMode: LEGACY_32 AddrWidth: 32b StackAddrWidth: 32b</div>
<div class="line">        MEM/EXPLICIT/RW REG/AL(REG8)/EXPLICIT/R </div>
<div class="line">        Read Write BASE= EAX(REG32) MemopLength = 1</div>
<div class="line"></div>
<div class="line">        rFLAGS: of-mod sf-mod zf-mod af-mod pf-mod cf-mod \ </div>
<div class="line">            Read:  Written: of sf zf af pf cf             writes</div>
<div class="line"></div>
<div class="line">% xed -e ADD EAX EBX</div>
<div class="line">Encodable! 01d8</div>
<div class="line"></div>
<div class="line">xed -e ADD EAX MEM4:ESP,EBX,4</div>
<div class="line">Encodable! 03049c</div>
<div class="line"></div>
<div class="line">% xed -d 6a00</div>
<div class="line">PUSH INT_ALU BASE  Opcode: 6a  Immed: 00 Bytes: 2</div>
<div class="line">        Ib/EXPLICIT/R STACKPUSH/SUPPRESSED/R </div>
<div class="line">        PUSH EffWidth: 32b</div>
<div class="line">        MachineMode: LEGACY_32 AddrWidth: 32b StackAddrWidth: 32b</div>
<div class="line">        MEM/SUPPRESSED/W REG/ESP(REG32)/SUPPRESSED/RW IMM/EXPLICIT/R </div>
<div class="line">        Write SEG= SS BASE= ESP(REG32) MemopLength = 4</div>
<div class="line">        IMMED: 00</div>
<div class="line"></div>
<div class="line">        Does not use rFLAGS</div>
<div class="line"></div>
<div class="line">% xed -e MOV EAX MEM4:SS:ESP</div>
<div class="line">Encodable! 8b0424</div>
</div><!-- fragment --><p>Or using the xed-ex3 example tool: </p><div class="fragment"><div class="line">% obj/xed-ex3</div>
<div class="line">Usage: obj/xed-ex3 [-16|-32|-64] [-s16|-s32] encode-<span class="keywordtype">string</span></div>
</div><!-- fragment --><p>The -16, -32 or -64 are for specifying the major mode of the machine. The major mode of the machine determines the default data operand size and default addressing width. In 64b mode, the default data size is 32b and the default addressing mode is 64b addressing. In 32b mode, the default addressing width is 32b. In 16b mode, the default addressing width is 16b. In 32b mode or 16b mode, the stack addressing width must also be specified. Usually it matches the major mode. The -s16 option is for specifying 16b stack addressing in 32b mode. The -s32 is for specifying 32b stack addressing in 16 bit mode.</p>
<div class="fragment"><div class="line">% obj/xed-ex3 -64 PUSH/64 RAX</div>
<div class="line">Encode request:</div>
<div class="line">PUSH Prefixes:  EffOpWidth: 64b EffAddrWidth: 64b</div>
<div class="line">        MachineMode: LONG_64 AddrWidth: 64b StackAddrWidth: 32b</div>
<div class="line">        REG/RAX(REG64)/EXPLICIT/RW </div>
<div class="line">        MemopLength = 0</div>
<div class="line"></div>
<div class="line">Encodable! 50</div>
<div class="line"></div>
<div class="line">% obj/xed-ex3 MOV MEM4:EAX IMM:11223344</div>
<div class="line">Encode request:</div>
<div class="line">MOV Prefixes:  EffOpWidth: 32b EffAddrWidth: 32b</div>
<div class="line">        MachineMode: LEGACY_32 AddrWidth: 32b StackAddrWidth: 32b</div>
<div class="line">        MEM0/EXPLICIT/RW IMM/EXPLICIT/RW </div>
<div class="line">        TmpltIdx=0 BASE= EAX(REG32) MemopLength = 0</div>
<div class="line">        IMMED: 0x11223344 <span class="keywordtype">signed</span>: 1144201745 starts@byte: 1</div>
<div class="line"></div>
<div class="line">Encodable! c70011223344</div>
</div><!-- fragment --><h1><a class="anchor" id="ENCODE_EXAMPLE"></a>
An example of using the encoder</h1>
<p>The encoder language file which is part of the xed command line tool shows how to build up instructions from scratch. The example uses a string to drive the creation of the instruction, but that is just an example. Look at the parse_encode_request function for the required pieces.</p>
<div class="fragment"><div class="line"><span class="comment">/*BEGIN_LEGAL </span></div>
<div class="line"><span class="comment">Intel Open Source License </span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">Copyright (c) 2002-2015 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">modification, are permitted provided that the following conditions are</span></div>
<div class="line"><span class="comment">met:</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">Redistributions of source code must retain the above copyright notice,</span></div>
<div class="line"><span class="comment">this list of conditions and the following disclaimer.  Redistributions</span></div>
<div class="line"><span class="comment">in binary form must reproduce the above copyright notice, this list of</span></div>
<div class="line"><span class="comment">conditions and the following disclaimer in the documentation and/or</span></div>
<div class="line"><span class="comment">other materials provided with the distribution.  Neither the name of</span></div>
<div class="line"><span class="comment">the Intel Corporation nor the names of its contributors may be used to</span></div>
<div class="line"><span class="comment">endorse or promote products derived from this software without</span></div>
<div class="line"><span class="comment">specific prior written permission.</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment">``AS IS&#39;&#39; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment">A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE INTEL OR</span></div>
<div class="line"><span class="comment">ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment">DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment">THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment">(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">END_LEGAL */</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This is an example of how to use the encoder from scratch in the context</span></div>
<div class="line"><span class="comment">// of parsing a string from the command line.  </span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="xed-interface_8h.html">xed-interface.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="xed-portability_8h.html">xed-portability.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;xed-examples-util.h&quot;</span></div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#include &quot;xed-enc-lang.H&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> xed_enc_lang_toupper(<span class="keywordtype">char</span> c) {</div>
<div class="line">    <span class="keywordflow">if</span> (c &gt;= <span class="charliteral">&#39;a&#39;</span> &amp;&amp; c &lt;= <span class="charliteral">&#39;z&#39;</span>)</div>
<div class="line">        <span class="keywordflow">return</span> c-<span class="charliteral">&#39;a&#39;</span>+<span class="charliteral">&#39;A&#39;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> c;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">string</span> upcase(<span class="keywordtype">string</span> s) {</div>
<div class="line">    <span class="keywordtype">string</span> t = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> len = <span class="keyword">static_cast&lt;</span><a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a><span class="keyword">&gt;</span>(s.size());</div>
<div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> i;</div>
<div class="line">    <span class="keywordflow">for</span>(i=0 ; i &lt; len ; i++ ) </div>
<div class="line">        t = t + xed_enc_lang_toupper(s[i]);</div>
<div class="line">    <span class="keywordflow">return</span> t;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div>
<div class="line">xed_split_args(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; sep, </div>
<div class="line">               <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; input, </div>
<div class="line">               vector&lt;string&gt;&amp; output_array)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// returns the number of args</span></div>
<div class="line">    <span class="comment">// rip off the separator characters and split the src string based on separators.</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// find the string between last_pos and pos. pos is after last_pos</span></div>
<div class="line">    string::size_type last_pos = input.find_first_not_of(sep, 0);</div>
<div class="line">    string::size_type pos = input.find_first_of(sep, last_pos);  </div>
<div class="line">    <span class="keywordflow">if</span> (CLIENT_VERBOSE3)</div>
<div class="line">        printf(<span class="stringliteral">&quot;input %s\tlast_pos &quot;</span> <a class="code" href="xed-portability_8h.html#a9091b96f5482bcfd24989443027cf922">XED_FMT_U</a> <span class="stringliteral">&quot; pos &quot;</span> <a class="code" href="xed-portability_8h.html#a9091b96f5482bcfd24989443027cf922">XED_FMT_U</a> <span class="stringliteral">&quot;\n&quot;</span>, </div>
<div class="line">               input.c_str() , <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(<a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a>,last_pos), <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(<a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a>,pos));</div>
<div class="line">    <span class="keywordtype">int</span> i=0;</div>
<div class="line">    <span class="keywordflow">while</span>( pos != string::npos &amp;&amp; last_pos != string::npos ) </div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">string</span> a = input.substr(last_pos, pos-last_pos);</div>
<div class="line">        output_array.push_back(a); </div>
<div class="line">        <span class="keywordflow">if</span> (CLIENT_VERBOSE3)</div>
<div class="line">            printf(<span class="stringliteral">&quot;\t\tlast_pos &quot;</span> XED_FMT_U <span class="stringliteral">&quot; pos &quot;</span> XED_FMT_U <span class="stringliteral">&quot; i %d\n&quot;</span>, </div>
<div class="line">                   <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(<a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a>,last_pos),</div>
<div class="line">                   <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(<a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a>,pos),</div>
<div class="line">                   i);</div>
<div class="line">        last_pos = input.find_first_not_of(sep, pos);</div>
<div class="line">        pos = input.find_first_of(sep, last_pos);  </div>
<div class="line">        i++;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (last_pos != string::npos &amp;&amp; pos == string::npos)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (CLIENT_VERBOSE3)</div>
<div class="line">            printf(<span class="stringliteral">&quot;\t\tGetting last substring at &quot;</span> XED_FMT_U <span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(<a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a>,last_pos));</div>
<div class="line">        <span class="keywordtype">string</span> a = input.substr(last_pos); <span class="comment">// get the rest of the string</span></div>
<div class="line">        output_array.push_back(a);</div>
<div class="line">        i++;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (CLIENT_VERBOSE3)</div>
<div class="line">        printf(<span class="stringliteral">&quot;\t returning %d\n&quot;</span>,i);</div>
<div class="line">    <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">vector&lt;string&gt; </div>
<div class="line">tokenize(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s,</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; delimiter) {</div>
<div class="line">    vector&lt;string&gt; v;</div>
<div class="line">    (void) xed_split_args(delimiter, s, v);</div>
<div class="line">    <span class="keywordflow">return</span> v;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> slash_split(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; src,</div>
<div class="line">                 <span class="keywordtype">string</span>&amp; first, <span class="comment">// output</span></div>
<div class="line">                 <span class="keywordtype">string</span>&amp;  second) <span class="comment">//output</span></div>
<div class="line">{</div>
<div class="line">  string::size_type p = src.find(<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (p == string::npos) {</div>
<div class="line">    first = src;</div>
<div class="line">    second = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    first = src.substr(0,p);</div>
<div class="line">    second = src.substr(p+1);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>immed_parser_t {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> valid;</div>
<div class="line">    <span class="keywordtype">string</span> immed;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width_bits;</div>
<div class="line">    xed_uint64_t immed_val;</div>
<div class="line">    <span class="keywordtype">string</span> tok0;</div>
<div class="line"></div>
<div class="line">    immed_parser_t(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s, </div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; arg_tok0) <span class="comment">//CONS</span></div>
<div class="line">        : valid(false),</div>
<div class="line">          tok0(arg_tok0)</div>
<div class="line">    {</div>
<div class="line">        vector&lt;string&gt; vs = tokenize(s,<span class="stringliteral">&quot;:&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (vs.size() == 2) {</div>
<div class="line">            <span class="keywordflow">if</span> (vs[0] == tok0) {</div>
<div class="line">                <span class="keywordtype">string</span> immed_str = vs[1];</div>
<div class="line">                immed_val = convert_ascii_hex_to_int(immed_str.c_str());</div>
<div class="line">                width_bits = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(immed_str.size()*4); <span class="comment">// nibbles to bits</span></div>
<div class="line">                valid = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span></div>
<div class="line">    print(ostream&amp; o)<span class="keyword"> const </span>{</div>
<div class="line">        o &lt;&lt; tok0 </div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> ;</div>
<div class="line">        <span class="keywordflow">if</span> (valid)  {</div>
<div class="line">            <span class="comment">// not printing immed_val directly because VC98 (MSVS6) cannot print uint64&#39;s</span></div>
<div class="line">            <a class="code" href="unionxed__union64__t.html">xed_union64_t</a> u;</div>
<div class="line">            u.<a class="code" href="unionxed__union64__t.html#a760537d841266354fcd9cc97b41cbeb1">u64</a> = immed_val;</div>
<div class="line">            o &lt;&lt; std::hex;</div>
<div class="line">            o &lt;&lt; setfill(<span class="charliteral">&#39;0&#39;</span>);</div>
<div class="line">            o &lt;&lt; std::setw(8);</div>
<div class="line">            o &lt;&lt; (int) u.<a class="code" href="unionxed__union64__t.html#a0d81e3e7820e93fe8356a22c8e745046">s</a>.<a class="code" href="unionxed__union64__t.html#a3e14c09b37cc7f2ada4210fb6374b3d5">hi32</a>;</div>
<div class="line">            o &lt;&lt; std::setw(8);</div>
<div class="line">            o &lt;&lt; (int) u.<a class="code" href="unionxed__union64__t.html#a0d81e3e7820e93fe8356a22c8e745046">s</a>.<a class="code" href="unionxed__union64__t.html#ab7de348b87fff28cf1e9faa4364d0b5a">lo32</a>;</div>
<div class="line">            o &lt;&lt; setfill(<span class="charliteral">&#39; &#39;</span>);</div>
<div class="line">            o &lt;&lt; std::dec;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> </div>
<div class="line">            o &lt;&lt; <span class="stringliteral">&quot;???&quot;</span>;</div>
<div class="line">        o &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">ostream&amp; operator&lt;&lt;(ostream&amp; o, <span class="keyword">const</span> immed_parser_t&amp; x) </div>
<div class="line">{</div>
<div class="line">    x.print(o);</div>
<div class="line">    <span class="keywordflow">return</span> o;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>seg_parser_t</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> valid;</div>
<div class="line">    <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> segment_reg;</div>
<div class="line">    <span class="keywordtype">string</span> segment;</div>
<div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> segno;</div>
<div class="line"></div>
<div class="line">    seg_parser_t(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s) <span class="comment">// CONS</span></div>
<div class="line">        : valid(false),</div>
<div class="line">          segment_reg(<a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>),</div>
<div class="line">          segno(0)</div>
<div class="line">    {</div>
<div class="line">        vector&lt;string&gt; vs = tokenize(s,<span class="stringliteral">&quot;:&quot;</span>);</div>
<div class="line">        <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> ntokens = <span class="keyword">static_cast&lt;</span><a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a><span class="keyword">&gt;</span>(vs.size());</div>
<div class="line">        <span class="keywordflow">if</span> (ntokens == 2) {</div>
<div class="line">            <span class="keywordflow">if</span> (vs[0] == <span class="stringliteral">&quot;SEG&quot;</span> || vs[0] == <span class="stringliteral">&quot;SEG0&quot;</span>) {</div>
<div class="line">                segment = vs[1];</div>
<div class="line">                segno = 0;</div>
<div class="line">                segment_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(segment.c_str());</div>
<div class="line">                <span class="keywordflow">if</span> (segment_reg != <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a> &amp;&amp; <a class="code" href="group__REGINTFC.html#ga9003309edac48c9c1dfca2187497c613">xed_reg_class</a>(segment_reg) == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76ab02b323ba71ce251bca0ac4206b7d028">XED_REG_CLASS_SR</a>) {</div>
<div class="line">                    valid=<span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (vs[0] == <span class="stringliteral">&quot;SEG1&quot;</span>) {</div>
<div class="line">                segment = vs[1];</div>
<div class="line">                segno = 1;</div>
<div class="line">                segment_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(segment.c_str());</div>
<div class="line">                <span class="keywordflow">if</span> (segment_reg != <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a> &amp;&amp; <a class="code" href="group__REGINTFC.html#ga9003309edac48c9c1dfca2187497c613">xed_reg_class</a>(segment_reg) == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76ab02b323ba71ce251bca0ac4206b7d028">XED_REG_CLASS_SR</a>) {</div>
<div class="line">                    valid=<span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>mem_bis_parser_t </div>
<div class="line">{</div>
<div class="line">    <span class="comment">// parse: MEMlength:[segment:]base,index,scale[,displacement]</span></div>
<div class="line">    <span class="comment">// parse: AGEN:base,index,scale[,displacement]</span></div>
<div class="line">    <span class="comment">// The displacement is optional</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// split on colons first</span></div>
<div class="line">    <span class="comment">// MEM4:FS:EAX,EBX,4,223344   mem4 fs eax,ebx,4,22334455  -&gt; 3 tokens</span></div>
<div class="line">    <span class="comment">// MEM4:FS:EAX,EBX,4          mem4 fs eax,ebx,4   -&gt; 3 tokens</span></div>
<div class="line">    <span class="comment">// MEM4:EAX,EBX,4,223344      mem4 eax,ebx,4,223344..  -&gt; 2 tokens</span></div>
<div class="line">    <span class="comment">// MEM4:FS:EAX,EBX,4          mem4 fs  eas,ebx,4     -&gt; 3 tokens</span></div>
<div class="line">    </div>
<div class="line"></div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> valid;</div>
<div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> mem;</div>
<div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> agen;</div>
<div class="line">    <a class="code" href="xed-types_8h.html#ad355c921b747945a82d62233a599c7b5">xed_bool_t</a> disp_valid;</div>
<div class="line">    <span class="keywordtype">string</span> segment;</div>
<div class="line">    <span class="keywordtype">string</span> base;</div>
<div class="line">    <span class="keywordtype">string</span> index;</div>
<div class="line">    <span class="keywordtype">string</span> scale;</div>
<div class="line">    <span class="keywordtype">string</span> disp; <span class="comment">//displacement</span></div>
<div class="line">    <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> segment_reg;</div>
<div class="line">    <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> base_reg;</div>
<div class="line">    <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> index_reg;</div>
<div class="line">    xed_uint8_t scale_val;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    xed_int64_t disp_val;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> disp_width_bits;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mem_len;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span></div>
<div class="line">    print(ostream&amp; o)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (agen) </div>
<div class="line">            o &lt;&lt; <span class="stringliteral">&quot;AGEN&quot;</span>; </div>
<div class="line">        <span class="keywordflow">if</span> (mem) </div>
<div class="line">            o &lt;&lt; <span class="stringliteral">&quot;MEM&quot;</span>; </div>
<div class="line">        <span class="keywordflow">if</span> (mem_len) </div>
<div class="line">            o &lt;&lt; setw(1) &lt;&lt; mem_len;</div>
<div class="line">        o &lt;&lt; <span class="stringliteral">&quot;(&quot;</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (segment_reg != <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>)</div>
<div class="line">            o &lt;&lt; segment_reg &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;</div>
<div class="line">        o &lt;&lt; base_reg;</div>
<div class="line">        o &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; index_reg </div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> </div>
<div class="line">          &lt;&lt; (<span class="keywordtype">unsigned</span> int) scale_val;</div>
<div class="line">        <span class="keywordflow">if</span> (disp_valid) </div>
<div class="line">            o &lt;&lt;  <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; disp;</div>
<div class="line">        o &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">     </div>
<div class="line">    }</div>
<div class="line">  </div>
<div class="line">    mem_bis_parser_t(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s) <span class="comment">//CONS</span></div>
<div class="line">        : valid(false),</div>
<div class="line">          mem(false),</div>
<div class="line">          agen(false),</div>
<div class="line">          disp_valid(false),</div>
<div class="line">          base(<span class="stringliteral">&quot;INVALID&quot;</span>),</div>
<div class="line">          index(<span class="stringliteral">&quot;INVALID&quot;</span>),</div>
<div class="line">          scale(<span class="stringliteral">&quot;1&quot;</span>),</div>
<div class="line">          segment_reg(<a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>),</div>
<div class="line">          base_reg(<a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>),</div>
<div class="line">          index_reg(<a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>),</div>
<div class="line">          disp_val(0),</div>
<div class="line">          disp_width_bits(0),</div>
<div class="line">          mem_len(0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">string</span> t = upcase(s);</div>
<div class="line">        <span class="comment">// split on colon first</span></div>
<div class="line">        vector&lt;string&gt; vs = tokenize(t,<span class="stringliteral">&quot;:&quot;</span>); </div>
<div class="line">        <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> ntokens = <span class="keyword">static_cast&lt;</span><a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a><span class="keyword">&gt;</span>(vs.size());</div>
<div class="line">        vector&lt;string&gt; astr;</div>
<div class="line">        <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> n_addr_tokens;</div>
<div class="line">        <span class="keywordtype">string</span> main_token, addr_token;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (ntokens == 3) { <span class="comment">/* has a segment base */</span></div>
<div class="line">            main_token = vs[0];</div>
<div class="line">            segment = vs[1];</div>
<div class="line">            addr_token = vs[2];</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntokens == 2) {</div>
<div class="line">            main_token = vs[0];</div>
<div class="line">            segment = <span class="stringliteral">&quot;INVALID&quot;</span>;</div>
<div class="line">            addr_token = vs[1];</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> </div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        <span class="keywordtype">size_t</span> n=0;</div>
<div class="line">        <span class="keywordflow">if</span> (main_token == <span class="stringliteral">&quot;AGEN&quot;</span>)</div>
<div class="line">            agen=<span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (main_token.substr(0,3) == <span class="stringliteral">&quot;MEM&quot;</span>) {</div>
<div class="line">            mem = <span class="keyword">true</span>;</div>
<div class="line">            n = 3;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> </div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (mem &amp;&amp; main_token.size() &gt; n) {</div>
<div class="line">            <span class="keywordtype">string</span> len = main_token.substr(n);</div>
<div class="line">            mem_len = strtol(len.c_str(),0,0);</div>
<div class="line">            <span class="comment">//printf(&quot;mem_len  = &quot; XED_FMT_U &quot;\n&quot;, mem_len);</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (agen &amp;&amp; segment != <span class="stringliteral">&quot;INVALID&quot;</span>)</div>
<div class="line">            xedex_derror(<span class="stringliteral">&quot;AGENs cannot have segment overrides&quot;</span>);</div>
<div class="line"></div>
<div class="line">        astr = tokenize(addr_token,<span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line">        n_addr_tokens = <span class="keyword">static_cast&lt;</span><a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a><span class="keyword">&gt;</span>(astr.size());</div>
<div class="line">        <span class="keywordflow">if</span> (n_addr_tokens == 0 || n_addr_tokens &gt; 4)</div>
<div class="line">            xedex_derror(<span class="stringliteral">&quot;Bad addressing mode syntax for memop&quot;</span>);</div>
<div class="line"></div>
<div class="line">        base = astr[0];</div>
<div class="line">        <span class="keywordflow">if</span> (base == <span class="stringliteral">&quot;-&quot;</span> || base == <span class="stringliteral">&quot;NA&quot;</span>) </div>
<div class="line">            base = <span class="stringliteral">&quot;INVALID&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (n_addr_tokens &gt; 2) </div>
<div class="line">            index = astr[1];</div>
<div class="line">        <span class="keywordflow">if</span> (index == <span class="stringliteral">&quot;-&quot;</span> || index == <span class="stringliteral">&quot;NA&quot;</span>) </div>
<div class="line">            index = <span class="stringliteral">&quot;INVALID&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (n_addr_tokens &gt; 2) </div>
<div class="line">            scale = astr[2];</div>
<div class="line">        <span class="keywordflow">if</span> (scale == <span class="stringliteral">&quot;-&quot;</span> || scale == <span class="stringliteral">&quot;NA&quot;</span>) </div>
<div class="line">            scale = <span class="stringliteral">&quot;1&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (scale == <span class="stringliteral">&quot;1&quot;</span> || scale == <span class="stringliteral">&quot;2&quot;</span> || scale == <span class="stringliteral">&quot;4&quot;</span> || scale == <span class="stringliteral">&quot;8&quot;</span>) {</div>
<div class="line">            valid=<span class="keyword">true</span>;</div>
<div class="line">            scale_val = <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(xed_uint8_t,strtol(scale.c_str(), 0, 10));</div>
<div class="line">            segment_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(segment.c_str());</div>
<div class="line">            base_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(base.c_str());</div>
<div class="line">            index_reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(index.c_str());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// look for a displacement</span></div>
<div class="line">            <span class="keywordflow">if</span> (n_addr_tokens == 4 &amp;&amp; astr[3] != <span class="stringliteral">&quot;-&quot;</span>) {</div>
<div class="line">                disp = astr[3];</div>
<div class="line">                disp_valid = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nibbles = <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(<span class="keywordtype">int</span>,disp.size());</div>
<div class="line">                <span class="keywordflow">if</span> (nibbles &amp; 1) {</div>
<div class="line">                    <span class="comment">// ensure an even number of nibbles</span></div>
<div class="line">                    <span class="keywordtype">string</span> zero(<span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line">                    disp = zero + disp;</div>
<div class="line">                    nibbles++;</div>
<div class="line">                }</div>
<div class="line">                xed_uint64_t unsigned64_disp;</div>
<div class="line">                unsigned64_disp = convert_ascii_hex_to_int(disp.c_str());</div>
<div class="line">                disp_width_bits = nibbles*4; <span class="comment">// nibbles to bits</span></div>
<div class="line">                <span class="keywordflow">switch</span> (disp_width_bits){</div>
<div class="line">                <span class="keywordflow">case</span> 8:  disp_val = <a class="code" href="xed-util_8h.html#a29a8c7d15c7bed2f34e174764b7532c6">xed_sign_extend8_64</a>(unsigned64_disp); <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 16: disp_val = <a class="code" href="xed-util_8h.html#a11ce8adb47394961e0963153f905a8c0">xed_sign_extend16_64</a>(unsigned64_disp); <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 32: disp_val = <a class="code" href="xed-util_8h.html#a18389860c680a9845b9b5045f3306089">xed_sign_extend32_64</a>(unsigned64_disp); <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 64: disp_val = unsigned64_disp; <span class="keywordflow">break</span>;</div>
<div class="line">                }               </div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">ostream&amp; operator&lt;&lt;(ostream&amp; o, <span class="keyword">const</span> mem_bis_parser_t&amp; x) {</div>
<div class="line">  x.print(o);</div>
<div class="line">  <span class="keywordflow">return</span> o;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="structxed__decoded__inst__s.html">xed_encoder_request_t</a> parse_encode_request(ascii_encode_request_t&amp; areq) {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line">    <a class="code" href="structxed__decoded__inst__s.html">xed_encoder_request_t</a> req;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// this calls xed_encoder_request_zero()</span></div>
<div class="line">    <a class="code" href="group__ENC.html#ga8a379853ad688ff61de9e73862617e40">xed_encoder_request_zero_set_mode</a>(&amp;req,&amp;(areq.dstate));</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* This is the important function here. This encodes an instruction</span></div>
<div class="line"><span class="comment">       from scratch.</span></div>
<div class="line"><span class="comment">       </span></div>
<div class="line"><span class="comment">    You must set:</span></div>
<div class="line"><span class="comment">    the machine mode (machine width, addressing widths)</span></div>
<div class="line"><span class="comment">    the iclass</span></div>
<div class="line"><span class="comment">    for some instructions you need to specify prefixes (like REP or LOCK).</span></div>
<div class="line"><span class="comment">    the operands:</span></div>
<div class="line"><span class="comment">    </span></div>
<div class="line"><span class="comment">           operand kind (XED_OPERAND_{AGEN,MEM0,MEM1,IMM0,IMM1,</span></div>
<div class="line"><span class="comment">           RELBR,PTR,REG0...REG15}</span></div>
<div class="line"><span class="comment">           </span></div>
<div class="line"><span class="comment">           operand order</span></div>
<div class="line"><span class="comment">           </span></div>
<div class="line"><span class="comment">              xed_encoder_request_set_operand_order(&amp;req,operand_index,</span></div>
<div class="line"><span class="comment">                                                       XED_OPERAND_*);</span></div>
<div class="line"><span class="comment">              where the operand_index is a sequential index starting at zero.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">           operand details </span></div>
<div class="line"><span class="comment">                     FOR MEMOPS: base,segment,index,scale,</span></div>
<div class="line"><span class="comment">                                         displacement for memops, </span></div>
<div class="line"><span class="comment">                  FOR REGISTERS: register name</span></div>
<div class="line"><span class="comment">                 FOR IMMEDIATES: immediate values</span></div>
<div class="line"><span class="comment">       </span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    </div>
<div class="line"></div>
<div class="line">    vector&lt;string&gt; tokens = tokenize(areq.command,<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">    <span class="comment">// first token has the operand and our temporary hack for the immediate</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">string</span> first, second;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> token_index = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(token_index &lt; tokens.size()) {</div>
<div class="line">        slash_split(tokens[token_index], first, second);</div>
<div class="line">        first = upcase(first);</div>
<div class="line">        <span class="keywordflow">if</span> (CLIENT_VERBOSE3)</div>
<div class="line">            printf( <span class="stringliteral">&quot;[%s][%s][%s]\n&quot;</span>,</div>
<div class="line">                    tokens[0].c_str(), first.c_str(), second.c_str());</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (token_index == 0 &amp;&amp; first == <span class="stringliteral">&quot;REP&quot;</span>) {</div>
<div class="line">            <a class="code" href="group__ENC.html#ga71d03e9d694f56fc362974f2d81e5464">xed_encoder_request_set_rep</a>(&amp;req);</div>
<div class="line">            token_index++;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token_index == 0 &amp;&amp; first == <span class="stringliteral">&quot;REPNE&quot;</span>) {</div>
<div class="line">            <a class="code" href="group__ENC.html#gaf651a483ec90cbf4495f87b114facc0b">xed_encoder_request_set_repne</a>(&amp;req);</div>
<div class="line">            token_index++;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">  </div>
<div class="line">        token_index++;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// we can attempt to override the mode </span></div>
<div class="line">    <span class="keywordflow">if</span> (second == <span class="stringliteral">&quot;8&quot;</span>) </div>
<div class="line">        <a class="code" href="group__ENC.html#ga53b937905ca110c4dd4b20e5695d8937">xed_encoder_request_set_effective_operand_width</a>(&amp;req, 8);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (second == <span class="stringliteral">&quot;16&quot;</span>) </div>
<div class="line">        <a class="code" href="group__ENC.html#ga53b937905ca110c4dd4b20e5695d8937">xed_encoder_request_set_effective_operand_width</a>(&amp;req, 16);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (second == <span class="stringliteral">&quot;32&quot;</span>) </div>
<div class="line">        <a class="code" href="group__ENC.html#ga53b937905ca110c4dd4b20e5695d8937">xed_encoder_request_set_effective_operand_width</a>(&amp;req, 32);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (second == <span class="stringliteral">&quot;64&quot;</span>) </div>
<div class="line">        <a class="code" href="group__ENC.html#ga53b937905ca110c4dd4b20e5695d8937">xed_encoder_request_set_effective_operand_width</a>(&amp;req, 64);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <a class="code" href="xed-iclass-enum_8h.html#ad318511ae9cc50f102251b3c91a1ab9f">xed_iclass_enum_t</a> iclass =  <a class="code" href="group__ENUM.html#gac4b76adf6ede75bbc5754866187fcfa2">str2xed_iclass_enum_t</a>(first.c_str());</div>
<div class="line">    <span class="keywordflow">if</span> (iclass == <a class="code" href="xed-iclass-enum_8h.html#ad318511ae9cc50f102251b3c91a1ab9fa2c77d475f97998fe763062db09fd15de">XED_ICLASS_INVALID</a>) {</div>
<div class="line">        ostringstream os;</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;Bad instruction name: &quot;</span> &lt;&lt; first;</div>
<div class="line">        xedex_derror(os.str().c_str());</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="group__ENC.html#gaff030e16b97deae21b1f7613684c54c7">xed_encoder_request_set_iclass</a>(&amp;req, iclass );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> memop = 0;</div>
<div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> regnum = 0;</div>
<div class="line">    <span class="comment">// put the operands in the request. Loop through tokens </span></div>
<div class="line">    <span class="comment">// (skip the opcode iclass, handled above)</span></div>
<div class="line">    <a class="code" href="xed-types_8h.html#a0c92e8263b7ca02d8e4826ae5b79bb30">xed_uint_t</a> operand_index = 0;</div>
<div class="line">    <span class="keywordflow">for</span>( i=token_index; i &lt; tokens.size(); i++, operand_index++ ) {</div>
<div class="line">        <span class="keywordtype">string</span> str_res_reg, second_x;</div>
<div class="line">        slash_split(tokens[i], str_res_reg, second_x);</div>
<div class="line">        str_res_reg = upcase(str_res_reg);</div>
<div class="line">        <span class="comment">// prune the AGEN or MEM(base,index,scale[,displacement]) text from</span></div>
<div class="line">        <span class="comment">// str_res_reg</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">// FIXME: add MEM(immed) for the OC1_A and OC1_O types????</span></div>
<div class="line">        mem_bis_parser_t mem_bis(str_res_reg);</div>
<div class="line">        <span class="keywordflow">if</span> (mem_bis.valid) {</div>
<div class="line">            <span class="keywordflow">if</span> (mem_bis.mem) {</div>
<div class="line">                <span class="keywordflow">if</span> (memop == 0) {</div>
<div class="line">                    <span class="comment">// Tell XED that we have a memory operand</span></div>
<div class="line">                    <a class="code" href="group__ENC.html#ga7b4e446882bcc615e917132f3fbb16b3">xed_encoder_request_set_mem0</a>(&amp;req);</div>
<div class="line">                    <span class="comment">// Tell XED that the mem0 operand is the next operand:</span></div>
<div class="line">                    <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(</div>
<div class="line">                        &amp;req,operand_index, <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa17757f8f75fb149d6a9ceff628403994">XED_OPERAND_MEM0</a>);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                    <a class="code" href="group__ENC.html#gafe70e5db7dc59e9880f2db3ec7e71d9d">xed_encoder_request_set_mem1</a>(&amp;req);</div>
<div class="line">                    <span class="comment">// Tell XED that the mem1 operand is the next operand:</span></div>
<div class="line">                    <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(</div>
<div class="line">                        &amp;req,operand_index, <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aabe26987877ba7bfe6b67c7106fd77286">XED_OPERAND_MEM1</a>);</div>
<div class="line">                }</div>
<div class="line">                memop++;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mem_bis.agen) {</div>
<div class="line">                <span class="comment">// Tell XED we have an AGEN</span></div>
<div class="line">                <a class="code" href="group__ENC.html#gaac846d407fd6537461a6efaccff7609d">xed_encoder_request_set_agen</a>(&amp;req);</div>
<div class="line">                <span class="comment">// The AGEN is the next operand</span></div>
<div class="line">                <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(</div>
<div class="line">                    &amp;req,operand_index, <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa3ce839ecfbe4f991f6c46b7cb767a703">XED_OPERAND_AGEN</a>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> </div>
<div class="line">                assert(mem_bis.agen || mem_bis.mem);</div>
<div class="line"></div>
<div class="line">            <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76">xed_reg_class_enum_t</a> rc = <a class="code" href="group__REGINTFC.html#ga46208c55a69fb76e42f1b5755aa4923e">xed_gpr_reg_class</a>(mem_bis.base_reg);</div>
<div class="line">            <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76">xed_reg_class_enum_t</a> rci = <a class="code" href="group__REGINTFC.html#ga46208c55a69fb76e42f1b5755aa4923e">xed_gpr_reg_class</a>(mem_bis.index_reg);</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (rc == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76aaca8356f5ea67683de3d49fb3de4583f">XED_REG_CLASS_GPR32</a> || rci == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76aaca8356f5ea67683de3d49fb3de4583f">XED_REG_CLASS_GPR32</a>) </div>
<div class="line">                <a class="code" href="group__ENC.html#gab416edcadb0d2b59fb62cfcd93991c3d">xed_encoder_request_set_effective_address_size</a>(&amp;req, 32);</div>
<div class="line">            <span class="keywordflow">if</span> (rc == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76a1a30b5648fb9dd4f8d9052cbe113f791">XED_REG_CLASS_GPR16</a> || rci == <a class="code" href="xed-reg-class-enum_8h.html#a8ac6bf3f9f78208385c46ea25324ea76a1a30b5648fb9dd4f8d9052cbe113f791">XED_REG_CLASS_GPR16</a>) </div>
<div class="line">                <a class="code" href="group__ENC.html#gab416edcadb0d2b59fb62cfcd93991c3d">xed_encoder_request_set_effective_address_size</a>(&amp;req, 16);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// fill in the memory fields</span></div>
<div class="line">            <a class="code" href="group__ENC.html#ga9002c58e013af93550df7bd9b37e13ed">xed_encoder_request_set_base0</a>(&amp;req, mem_bis.base_reg);</div>
<div class="line">            <a class="code" href="group__ENC.html#gad436ed3d253f15e11f4c943e0308db06">xed_encoder_request_set_index</a>(&amp;req, mem_bis.index_reg);</div>
<div class="line">            <a class="code" href="group__ENC.html#gaca791f284c852c6ae4c071ba5751d257">xed_encoder_request_set_scale</a>(&amp;req, mem_bis.scale_val);</div>
<div class="line">            <a class="code" href="group__ENC.html#ga72a43d42aa1c15bba69bcab84439471a">xed_encoder_request_set_seg0</a>(&amp;req, mem_bis.segment_reg);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (mem_bis.mem_len) </div>
<div class="line">                <a class="code" href="group__ENC.html#ga03790a14a625c544edcbda559e359f14">xed_encoder_request_set_memory_operand_length</a>(</div>
<div class="line">                    &amp;req,</div>
<div class="line">                    mem_bis.mem_len ); <span class="comment">// BYTES</span></div>
<div class="line">            <span class="keywordflow">if</span> (mem_bis.disp_valid)</div>
<div class="line">                <a class="code" href="group__ENC.html#gaf745dfb40af1361b8a9b9f1ecb4f0228">xed_encoder_request_set_memory_displacement</a>(</div>
<div class="line">                    &amp;req,</div>
<div class="line">                    mem_bis.disp_val,</div>
<div class="line">                    mem_bis.disp_width_bits/8);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        seg_parser_t seg_parser(str_res_reg);</div>
<div class="line">        <span class="keywordflow">if</span> (seg_parser.valid) {</div>
<div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div>
<div class="line">                printf(<span class="stringliteral">&quot;Setting segment to %s\n&quot;</span>,</div>
<div class="line">                       <a class="code" href="group__ENUM.html#ga2219331ccd4d809d431e81fe5e857e95">xed_reg_enum_t2str</a>(seg_parser.segment_reg));</div>
<div class="line">            <span class="keywordflow">if</span> (seg_parser.segno == 0)</div>
<div class="line">                <a class="code" href="group__ENC.html#ga72a43d42aa1c15bba69bcab84439471a">xed_encoder_request_set_seg0</a>(&amp;req, seg_parser.segment_reg);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <span class="comment">/*  need SEG1 for MOVS[BWDQ]*/</span></div>
<div class="line">                <a class="code" href="group__ENC.html#gafb3db0b671837fab077f4db357c7fe04">xed_encoder_request_set_seg1</a>(&amp;req, seg_parser.segment_reg);</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* SEG/SEG0/SEG1 is NOT a normal operand. It is a setting, like</span></div>
<div class="line"><span class="comment">             * the lock prefix. Normally the segment will be specified with</span></div>
<div class="line"><span class="comment">             * normal memory operations. With memops without MODRM, or</span></div>
<div class="line"><span class="comment">             * impliclit memops, we need a way of specifying the segment</span></div>
<div class="line"><span class="comment">             * when it is not the default. This is the way. it does not</span></div>
<div class="line"><span class="comment">             * change encoding forms. (When segments are &quot;moved&quot;, they are</span></div>
<div class="line"><span class="comment">             * REG operands, not SEG0/1, and are specified by name like EAX</span></div>
<div class="line"><span class="comment">             * is.) */</span></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        immed_parser_t imm(str_res_reg, <span class="stringliteral">&quot;IMM&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (imm.valid) {</div>
<div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div>
<div class="line">                printf(<span class="stringliteral">&quot;Setting immediate value to &quot;</span> <a class="code" href="xed-portability_8h.html#a99b93e37a937348afa3e458fb1e04fb1">XED_FMT_LX</a> <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                       imm.immed_val);</div>
<div class="line">            <a class="code" href="group__ENC.html#ga5dcaec413dfefdd6ca2ad179e5a181c9">xed_encoder_request_set_uimm0_bits</a>(&amp;req, </div>
<div class="line">                                               imm.immed_val,</div>
<div class="line">                                               imm.width_bits);</div>
<div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div>
<div class="line">                                                  operand_index,</div>
<div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa7cfee5454147cd3ea586172facd26f30">XED_OPERAND_IMM0</a>);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        immed_parser_t simm(str_res_reg, <span class="stringliteral">&quot;SIMM&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (simm.valid) {</div>
<div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div>
<div class="line">                printf(<span class="stringliteral">&quot;Setting immediate value to &quot;</span> <a class="code" href="xed-portability_8h.html#a99b93e37a937348afa3e458fb1e04fb1">XED_FMT_LX</a> <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                       simm.immed_val);</div>
<div class="line">            <a class="code" href="group__ENC.html#gaf2477dc50a13ec112d7cf3f3fa5c9178">xed_encoder_request_set_simm</a>(</div>
<div class="line">                &amp;req, </div>
<div class="line">                <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(xed_int32_t,simm.immed_val),</div>
<div class="line">                simm.width_bits/8); <span class="comment">//FIXME</span></div>
<div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div>
<div class="line">                                                  operand_index,</div>
<div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa7cfee5454147cd3ea586172facd26f30">XED_OPERAND_IMM0</a>);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        immed_parser_t imm2(str_res_reg, <span class="stringliteral">&quot;IMM2&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (imm2.valid) {</div>
<div class="line">            <span class="keywordflow">if</span> (imm2.width_bits != 8)</div>
<div class="line">                xedex_derror(<span class="stringliteral">&quot;2nd immediate must be just 1 byte long&quot;</span>);</div>
<div class="line">            <a class="code" href="group__ENC.html#ga4edd1347ebaceee3811584123b4daa9b">xed_encoder_request_set_uimm1</a>(&amp;req, imm2.immed_val);</div>
<div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div>
<div class="line">                                                  operand_index,</div>
<div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aaecf4b40f8ec183182501a80b93b5b4dc">XED_OPERAND_IMM1</a>);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        immed_parser_t disp(str_res_reg, <span class="stringliteral">&quot;BRDISP&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (disp.valid) {</div>
<div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div>
<div class="line">                printf(<span class="stringliteral">&quot;Setting  displacement value to &quot;</span> <a class="code" href="xed-portability_8h.html#a99b93e37a937348afa3e458fb1e04fb1">XED_FMT_LX</a> <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                       disp.immed_val);</div>
<div class="line">            <a class="code" href="group__ENC.html#ga3594acbdb2001a816da28b7554b2ae4c">xed_encoder_request_set_branch_displacement</a>(</div>
<div class="line">                &amp;req,</div>
<div class="line">                <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(xed_uint32_t,disp.immed_val),</div>
<div class="line">                disp.width_bits/8); <span class="comment">//FIXME</span></div>
<div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div>
<div class="line">                                                  operand_index,</div>
<div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa6f36302cd147e020b2662b75fa314c17">XED_OPERAND_RELBR</a>);</div>
<div class="line">            <a class="code" href="group__ENC.html#gad447fb779e58b7eaae0dd54e51af6066">xed_encoder_request_set_relbr</a>(&amp;req);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        immed_parser_t ptr_disp(str_res_reg, <span class="stringliteral">&quot;PTR&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (ptr_disp.valid) {</div>
<div class="line">            <span class="keywordflow">if</span> (CLIENT_VERBOSE3) </div>
<div class="line">                printf(<span class="stringliteral">&quot;Setting pointer displacement value to &quot;</span> <a class="code" href="xed-portability_8h.html#a99b93e37a937348afa3e458fb1e04fb1">XED_FMT_LX</a> <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                       ptr_disp.immed_val);</div>
<div class="line">            <a class="code" href="group__ENC.html#ga3594acbdb2001a816da28b7554b2ae4c">xed_encoder_request_set_branch_displacement</a>(</div>
<div class="line">                &amp;req,</div>
<div class="line">                <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(xed_uint32_t,ptr_disp.immed_val),</div>
<div class="line">                ptr_disp.width_bits/8); <span class="comment">//FIXME</span></div>
<div class="line">            <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req,</div>
<div class="line">                                                  operand_index,</div>
<div class="line">                                                  <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aaf84141b5908fd0d494f446a66f3eeef3">XED_OPERAND_PTR</a>);</div>
<div class="line">            <a class="code" href="group__ENC.html#ga7be1c7da28a5d88f485f7e80b67959b4">xed_encoder_request_set_ptr</a>(&amp;req);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61">xed_reg_enum_t</a> reg = <a class="code" href="group__ENUM.html#ga48dc3d086b469ae580ca47917043c2fd">str2xed_reg_enum_t</a>(str_res_reg.c_str());</div>
<div class="line">        <span class="keywordflow">if</span> (reg == <a class="code" href="xed-reg-enum_8h.html#af05c33c5a68e9304d1d8ac0408ae3f61afac474058f0819d415285511086bf219">XED_REG_INVALID</a>) {</div>
<div class="line">            ostringstream os;</div>
<div class="line">            os &lt;&lt; <span class="stringliteral">&quot;Bad register name: &quot;</span> &lt;&lt; str_res_reg &lt;&lt; <span class="stringliteral">&quot; on operand &quot;</span> &lt;&lt; i;</div>
<div class="line">            xedex_derror(os.str().c_str()); <span class="comment">// dies</span></div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// The registers operands aer numbered starting from the first one</span></div>
<div class="line">        <span class="comment">// as XED_OPERAND_REG0. We incremenet regnum (below) every time we add a</span></div>
<div class="line">        <span class="comment">// register operands.</span></div>
<div class="line">        <a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011a">xed_operand_enum_t</a> r =</div>
<div class="line">            <a class="code" href="xed-portability_8h.html#ae0cdf0e8a0284d011be1a08e8a4e3094">XED_STATIC_CAST</a>(<a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011a">xed_operand_enum_t</a>,<a class="code" href="xed-operand-enum_8h.html#a09c2a35d8bb7bfe68bb3d34b0a5e011aa4a8a5c45ea6041f25d7b98e3892bb389">XED_OPERAND_REG0</a> + regnum);</div>
<div class="line">        <span class="comment">// store the register identifer in the operand storage field</span></div>
<div class="line">        <a class="code" href="group__ENC.html#gaba22ae36cab0f632d5461830cc9a3133">xed_encoder_request_set_reg</a>(&amp;req, r, reg);</div>
<div class="line">        <span class="comment">// store the operand storage field name in the encode-order array</span></div>
<div class="line">        <a class="code" href="group__ENC.html#ga1e46ce602263f0de591b3ebc268cc12e">xed_encoder_request_set_operand_order</a>(&amp;req, operand_index, r);</div>
<div class="line">        regnum++;</div>
<div class="line">    } <span class="comment">// for loop</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> req;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jan 21 2015 02:11:38 for XED by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
